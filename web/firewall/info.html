<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>FIREWALL - Manual de Uso</title>
    <style>
        html, body { 
            margin: 0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .info-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        h2 {
            color: #333;
            margin-top: 0;
            font-size: 28px;
        }
        h3 {
            color: #667eea;
            margin-top: 25px;
            font-size: 20px;
        }
        p, li {
            color: #666;
            line-height: 1.8;
            font-size: 15px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-left-color: #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="info-container">
        <h2>üî• FIREWALL - Manual de Uso</h2>
        
        <div class="section">
            <h3>üìã Descripci√≥n General</h3>
            <p>El m√≥dulo Firewall permite gestionar reglas de iptables organizadas por VLANs. Crea cadenas personalizadas para cada VLAN configurada en el sistema.</p>
        </div>

        <div class="section">
            <h3>‚öôÔ∏è Requisitos Previos</h3>
            <ul>
                <li><strong>‚ö†Ô∏è WAN debe estar configurada</strong> - El firewall requiere que la interfaz WAN est√© configurada antes de iniciarse</li>
                <li>Tener VLANs configuradas en el sistema</li>
                <li>Permisos sudo configurados para iptables</li>
                <li>Verificar con: <code>sudo iptables -L -n</code></li>
            </ul>
        </div>

        <div class="section">
            <h3>üéØ Funciones Principales</h3>
            
            <p><strong>START:</strong> Inicia el firewall creando cadenas personalizadas para cada VLAN</p>
            <ul>
                <li>Crea cadena <code>VLAN_X</code> para cada VLAN configurada</li>
                <li><strong>Vincula la cadena a FORWARD:</strong> el tr√°fico desde la IP de cada VLAN pasa por su cadena</li>
                <li>Por defecto, todas las reglas est√°n en ACCEPT (sin restricci√≥n)</li>
                <li>Guarda configuraci√≥n en <code>config/firewall/firewall.json</code></li>
            </ul>

            <p><strong>STOP:</strong> Detiene el firewall eliminando todas las cadenas</p>
            <ul>
                <li><strong>Desvincula las cadenas de FORWARD</strong> eliminando las reglas de salto</li>
                <li>Limpia reglas de cada cadena VLAN</li>
                <li>Elimina las cadenas personalizadas</li>
                <li>Actualiza estado a detenido</li>
            </ul>

            <p><strong>RESTART:</strong> Reinicia el firewall (ejecuta STOP seguido de START)</p>

            <p><strong>STATUS:</strong> Muestra el estado actual del firewall</p>
            <ul>
                <li>Lista cada VLAN y su estado (ACTIVA/INACTIVA)</li>
                <li><strong>Verifica vinculaci√≥n a FORWARD:</strong> indica si la cadena est√° activa</li>
                <li>Muestra la IP de origen de cada VLAN</li>
                <li>Muestra si la whitelist est√° habilitada</li>
                <li>Muestra las primeras reglas activas de iptables</li>
            </ul>
        </div>

        <div class="section">
            <h3>üîê Funciones de Whitelist</h3>
            
            <p><strong>ENABLE_WHITELIST:</strong> Habilita whitelist en una VLAN (bloquea todo excepto destinos permitidos)</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code>, <code>whitelist</code> (lista de IPs/puertos)</li>
                <li>Formato de reglas: <code>"192.168.1.1"</code> o <code>"192.168.1.1:80"</code></li>
                <li>Agrega regla DROP al final para bloquear todo lo dem√°s</li>
            </ul>

            <p><strong>DISABLE_WHITELIST:</strong> Deshabilita whitelist (vuelve a ACCEPT todo)</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code></li>
                <li>Limpia todas las reglas de la cadena</li>
                <li>Restaura comportamiento permisivo</li>
            </ul>

            <p><strong>ADD_RULE:</strong> Agrega una regla a la whitelist existente</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code>, <code>rule</code></li>
                <li>Ejemplo: <code>{"vlan_id": 1, "rule": "8.8.8.8"}</code></li>
                <li>Reaplica autom√°ticamente la whitelist si est√° habilitada</li>
            </ul>

            <p><strong>REMOVE_RULE:</strong> Elimina una regla de la whitelist</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code>, <code>rule</code></li>
                <li>Reaplica la whitelist sin esa regla</li>
            </ul>
        </div>

        <div class="section">
            <h3>üîí Funciones de Aislamiento y Restricci√≥n</h3>
            
            <p><strong>AISLAR:</strong> Bloquea tr√°fico entre VLANs (FORWARD)</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code></li>
                <li>Inserta reglas DROP en <code>SECURITY_DROPS_FIREWALL</code></li>
                <li>VLAN 1: Bloquea tr√°fico entrante (-d)</li>
                <li>Otras: Bloquea tr√°fico saliente (-s)</li>
                <li>Independiente de whitelist y restricciones</li>
            </ul>

            <p><strong>DESAISLAR:</strong> Elimina el bloqueo entre VLANs</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code></li>
                <li>Elimina reglas de <code>SECURITY_DROPS_FIREWALL</code></li>
            </ul>

            <p><strong>RESTRICT:</strong> Bloquea acceso al router (INPUT) desde una VLAN</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code></li>
                <li><strong>VLAN 1 y 2:</strong> DROP total de tr√°fico desde la VLAN</li>
                <li><strong>Otras VLANs:</strong> Permite DHCP (67/68) e ICMP (ping), bloquea lo dem√°s</li>
                <li>Diferente del aislamiento: restringe acceso al router, no entre VLANs</li>
            </ul>

            <p><strong>UNRESTRICT:</strong> Elimina las restricciones de una VLAN</p>
            <ul>
                <li>Par√°metros: <code>vlan_id</code></li>
                <li>Elimina todas las reglas INPUT de restricci√≥n</li>
            </ul>
        </div>

        <div class="section">
            <h3>üîß Configuraci√≥n de VLANs</h3>
            <p>El firewall lee la configuraci√≥n desde <code>config/vlans/vlans.json</code>:</p>
            <ul>
                <li>VLAN ID: Identificador num√©rico</li>
                <li>Nombre: Etiqueta descriptiva</li>
                <li>IP: Direcci√≥n IP de la interfaz VLAN</li>
            </ul>
        </div>

        <div class="warning">
            <h3>‚ö†Ô∏è Advertencias</h3>
            <ul>
                <li><strong>Las cadenas se vinculan autom√°ticamente a FORWARD:</strong> el tr√°fico desde las IPs de VLAN pasa por las cadenas personalizadas</li>
                <li>Por defecto, las reglas est√°n en ACCEPT (sin bloqueo)</li>
                <li>El filtrado es por IP de origen (-s): tr√°fico saliente desde cada VLAN</li>
                <li>Use la interfaz web para configurar whitelist y reglas espec√≠ficas</li>
                <li>Aseg√∫rese de tener acceso alternativo al servidor antes de aplicar reglas restrictivas</li>
            </ul>
        </div>

        <div class="success">
            <h3>‚úÖ Ejemplo de Uso</h3>
            <ol>
                <li>Configure VLANs en el m√≥dulo correspondiente</li>
                <li>Haga clic en <strong>START</strong> para inicializar el firewall</li>
                <li>Use <strong>STATUS</strong> para verificar las cadenas creadas</li>
                <li><strong>Para habilitar whitelist:</strong>
                    <ul>
                        <li>Use la interfaz web o API con: <code>enable_whitelist</code></li>
                        <li>Par√°metros: <code>{"vlan_id": 1, "whitelist": ["8.8.8.8", "1.1.1.1:53"]}</code></li>
                    </ul>
                </li>
                <li><strong>Para agregar m√°s reglas:</strong> Use <code>add_rule</code> con <code>{"vlan_id": 1, "rule": "192.168.1.1"}</code></li>
                <li>Use <strong>RESTART</strong> para reaplicar configuraci√≥n si es necesario</li>
            </ol>
        </div>

        <div class="section">
            <h3>üìÅ Archivos de Configuraci√≥n</h3>
            <ul>
                <li><code>config/vlans/vlans.json</code> - Configuraci√≥n de VLANs</li>
                <li><code>config/firewall/firewall.json</code> - Estado y reglas del firewall</li>
                <li><code>logs/firewall/</code> - Directorio de logs</li>
            </ul>
        </div>

        <div class="section">
            <h3>üêõ Diagn√≥stico</h3>
            <p>Si encuentra problemas:</p>
            <ul>
                <li>Verifique logs del servidor en la terminal</li>
                <li>Ejecute <code>sudo iptables -L -n -v</code> para ver reglas actuales</li>
                <li>Verifique que sudo funcione sin contrase√±a: <code>sudo -n iptables -L</code></li>
                <li>Revise <code>config/firewall/firewall.json</code> para ver configuraci√≥n guardada</li>
            </ul>
        </div>

        <div class="section">
            <h3>üîÑ Versi√≥n</h3>
            <p>Firewall Module v2.2 - Con soporte de Whitelist</p>
            <p><strong>Nuevo en v2.2:</strong></p>
            <ul>
                <li>üîê Soporte completo de whitelist por VLAN</li>
                <li>‚úÖ Funciones: enable_whitelist, disable_whitelist, add_rule, remove_rule</li>
                <li>‚úÖ Formato flexible: IP o IP:puerto</li>
                <li>‚úÖ Aplicaci√≥n autom√°tica al hacer START</li>
            </ul>
            <p><strong>Versiones anteriores:</strong></p>
            <ul>
                <li>v2.1: Vinculaci√≥n autom√°tica a FORWARD</li>
                <li>v2.0: Versi√≥n base simplificada</li>
            </ul>
            <p>√öltima actualizaci√≥n: Enero 2026</p>
        </div>
    </div>
</body>
</html>
